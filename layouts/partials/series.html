{{- if .Params.series -}}
{{- $currentPage := . -}}
{{- $seriesName := .Params.series -}}

{{- /* Find all pages in this series */ -}}
{{- $seriesPages := where .Site.RegularPages "Params.series" "eq" $seriesName -}}

{{- /* Sort by series_order if available, otherwise by date */ -}}
{{- $hasOrder := false -}}
{{- range $seriesPages -}}
  {{- if .Params.series_order -}}
    {{- $hasOrder = true -}}
  {{- end -}}
{{- end -}}

{{- if $hasOrder -}}
  {{- $seriesPages = sort $seriesPages "Params.series_order" "asc" -}}
{{- else -}}
  {{- $seriesPages = sort $seriesPages "Date" "asc" -}}
{{- end -}}

{{- if gt (len $seriesPages) 1 -}}
<div class="series-container">
  <details class="series-details" open>
    <summary class="series-summary">
      <span class="series-title">ğŸ“š Series: {{ $seriesName }}</span>
      <span class="series-count">{{ len $seriesPages }} part{{ if gt (len $seriesPages) 1 }}s{{ end }} in this series</span>
    </summary>

    <ol class="series-list">
      {{- range $index, $page := $seriesPages -}}
      <li class="series-item{{ if eq $page.Permalink $currentPage.Permalink }} series-current{{ end }}">
        {{- if eq $page.Permalink $currentPage.Permalink -}}
          <span class="series-link-current">
            <span class="series-indicator">â¤</span> {{ $page.Title }}
            <span class="series-badge">You are here</span>
          </span>
        {{- else -}}
          <a href="{{ $page.Permalink }}" class="series-link">
            {{ $page.Title }}
          </a>
        {{- end -}}
      </li>
      {{- end -}}
    </ol>
  </details>
</div>
{{- end -}}
{{- end -}}
