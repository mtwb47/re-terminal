{{- $recent    := site.Data.lastfm.recent    | default dict -}}
{{- $toptracks := site.Data.lastfm.toptracks | default dict -}}
{{- $topartists:= site.Data.lastfm.topartists| default dict -}}
{{- $userinfo  := site.Data.lastfm.userinfo  | default dict -}}

<div class="lastfm">

  <h3>Most recent scrobble</h3>
  {{- $rlist := index (index $recent "recenttracks" | default dict) "track" | default (slice) -}}
  {{- if gt (len $rlist) 0 -}}
    {{- $t := index $rlist 0 -}}
    {{- $name := index $t "name" -}}
    {{- $url  := index $t "url" -}}
    {{- $artist := index (index $t "artist") "#text" -}}
    {{- $album  := index (index $t "album") "#text" -}}
    {{- $now := index (index $t "@attr") "nowplaying" -}}
    {{- $when := index (index $t "date") "#text" -}}
    <p><strong>{{ if $url }}<a href="{{ $url }}">{{ $name }}</a>{{ else }}{{ $name }}{{ end }}</strong>
       — {{ $artist }}{{ with $album }} <em>({{ . }})</em>{{ end }}
       {{ if eq $now "true" }} · now playing{{ else if $when }} · {{ $when }}{{ end }}
    </p>
  {{- else -}}<p>No recent tracks.</p>{{- end }}

  <h3>Top 10 tracks (overall)</h3>
  {{- $tracks := index (index $toptracks "toptracks" | default dict) "track" | default (slice) -}}
  {{- if gt (len $tracks) 0 -}}
    <ol>
      {{- range $tracks -}}
        {{- $nm := index . "name" -}}
        {{- $url := index . "url" -}}
        <li>{{ if $url }}<a href="{{ $url }}">{{ $nm }}</a>{{ else }}{{ $nm }}{{ end }} — {{ index (index . "artist") "name" }} ({{ index . "playcount" }})</li>
      {{- end -}}
    </ol>
  {{- else -}}<p>No top tracks.</p>{{- end }}

  <h3>Top 10 artists (overall)</h3>
  {{- $artists := index (index $topartists "topartists" | default dict) "artist" | default (slice) -}}
  {{- if gt (len $artists) 0 -}}
    <ol>
      {{- range $artists -}}
        {{- $nm := index . "name" -}}
        {{- $url := index . "url" -}}
        <li>{{ if $url }}<a href="{{ $url }}">{{ $nm }}</a>{{ else }}{{ $nm }}{{ end }} ({{ index . "playcount" }})</li>
      {{- end -}}
    </ol>
  {{- else -}}<p>No top artists.</p>{{- end }}

  <h3>Total scrobbles</h3>
  {{- $u := index $userinfo "user" | default dict -}}
  <p>{{ index $u "playcount" | default "0" }}</p>
</div>
